



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.3">
    
    
      
        <title>Module 4 - Disperse Volumes (Erasure Coding) - RHGS Test Drive Instructions</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.9b572555.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#lab-guide-gluster-test-drive-module-4-disperse-volumes-erasure-coding" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="RHGS Test Drive Instructions" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                RHGS Test Drive Instructions
              </span>
              <span class="md-header-nav__topic">
                Module 4 - Disperse Volumes (Erasure Coding)
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    RHGS Test Drive Instructions
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gluster-module-1/" title="Module 1 - Introduction to Gluster concepts" class="md-nav__link">
      Module 1 - Introduction to Gluster concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gluster-module-2/" title="Module 2 - Volume Setup and Client Access" class="md-nav__link">
      Module 2 - Volume Setup and Client Access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gluster-module-3/" title="Module 3 - Volume Operations and Administration" class="md-nav__link">
      Module 3 - Volume Operations and Administration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Module 4 - Disperse Volumes (Erasure Coding)
      </label>
    
    <a href="./" title="Module 4 - Disperse Volumes (Erasure Coding)" class="md-nav__link md-nav__link--active">
      Module 4 - Disperse Volumes (Erasure Coding)
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab-agenda" title="Lab Agenda" class="md-nav__link">
    Lab Agenda
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" title="Getting Started" class="md-nav__link">
    Getting Started
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-setup" title="Lab Setup" class="md-nav__link">
    Lab Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connect-to-the-lab" title="Connect to the Lab" class="md-nav__link">
    Connect to the Lab
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-disperse-volumes" title="About Disperse Volumes" class="md-nav__link">
    About Disperse Volumes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#erasure-coding-and-parity" title="Erasure Coding and Parity" class="md-nav__link">
    Erasure Coding and Parity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" title="Use Cases" class="md-nav__link">
    Use Cases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-your-gdeploy-configuration" title="Build your gdeploy Configuration" class="md-nav__link">
    Build your gdeploy Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hosts-section" title="Hosts Section" class="md-nav__link">
    Hosts Section
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-setup-section" title="Backend-Setup Section" class="md-nav__link">
    Backend-Setup Section
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-section" title="Volume Section" class="md-nav__link">
    Volume Section
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clients-section" title="Clients Section" class="md-nav__link">
    Clients Section
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-and-review-your-disperse-volume" title="Deploy and Review your Disperse Volume" class="md-nav__link">
    Deploy and Review your Disperse Volume
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-operations-on-a-disperse-volume" title="File Operations on a Disperse Volume" class="md-nav__link">
    File Operations on a Disperse Volume
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-files-from-the-client" title="Create Files from the Client" class="md-nav__link">
    Create Files from the Client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-disperse-volume-resilliency" title="Test Disperse Volume Resilliency" class="md-nav__link">
    Test Disperse Volume Resilliency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gluster-module-5/" title="Module 5 - Snapshot Operations and Administration" class="md-nav__link">
      Module 5 - Snapshot Operations and Administration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gluster-module-6/" title="Module 6 - Geo-Replication and Disaster Recovery" class="md-nav__link">
      Module 6 - Geo-Replication and Disaster Recovery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gluster-module-7/" title="Module 7 - Brick Replacement" class="md-nav__link">
      Module 7 - Brick Replacement
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab-agenda" title="Lab Agenda" class="md-nav__link">
    Lab Agenda
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" title="Getting Started" class="md-nav__link">
    Getting Started
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-setup" title="Lab Setup" class="md-nav__link">
    Lab Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connect-to-the-lab" title="Connect to the Lab" class="md-nav__link">
    Connect to the Lab
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-disperse-volumes" title="About Disperse Volumes" class="md-nav__link">
    About Disperse Volumes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#erasure-coding-and-parity" title="Erasure Coding and Parity" class="md-nav__link">
    Erasure Coding and Parity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" title="Use Cases" class="md-nav__link">
    Use Cases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-your-gdeploy-configuration" title="Build your gdeploy Configuration" class="md-nav__link">
    Build your gdeploy Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hosts-section" title="Hosts Section" class="md-nav__link">
    Hosts Section
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-setup-section" title="Backend-Setup Section" class="md-nav__link">
    Backend-Setup Section
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-section" title="Volume Section" class="md-nav__link">
    Volume Section
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clients-section" title="Clients Section" class="md-nav__link">
    Clients Section
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-and-review-your-disperse-volume" title="Deploy and Review your Disperse Volume" class="md-nav__link">
    Deploy and Review your Disperse Volume
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-operations-on-a-disperse-volume" title="File Operations on a Disperse Volume" class="md-nav__link">
    File Operations on a Disperse Volume
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-files-from-the-client" title="Create Files from the Client" class="md-nav__link">
    Create Files from the Client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-disperse-volume-resilliency" title="Test Disperse Volume Resilliency" class="md-nav__link">
    Test Disperse Volume Resilliency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="lab-guide-gluster-test-drive-module-4-disperse-volumes-erasure-coding">Lab Guide <br/> Gluster Test Drive Module 4 <br/> Disperse Volumes (Erasure Coding)</h1>
<h2 id="lab-agenda">Lab Agenda</h2>
<p>Welcome to the Gluster Test Drive Module 4 - Disperse Volumes (Erasure Coding). In this lab you will:</p>
<ul>
<li>Understand the basic concepts of erasure coding</li>
<li>Create a <code>gdeploy</code> configuration for a disperse volume</li>
<li>Deploy a disperse volume using <code>gdeploy</code></li>
<li>Write files to a disperse volume and observe the backend</li>
<li>Manually fail bricks and observe the high availability of erasure coding</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<p>If you have not already done so, click the <img src="http://us-west-2-aws-training.s3.amazonaws.com/awsu-spl/spl02-working-ebs/media/image005.png"> button in the navigation bar above to launch your lab. If you are prompted for a token, use the one distributed to you (or credits you&rsquo;ve purchased).</p>
<blockquote>
<p><strong>NOTE</strong> It may take <strong>up to 10 minutes</strong> for your lab systems to start up before you can access them.</p>
</blockquote>
<h2 id="lab-setup">Lab Setup</h2>
<h3 id="connect-to-the-lab">Connect to the Lab</h3>
<p>Connect to the <strong>rhgs1</strong> server instance using its public IP address from the <strong>Addl. Info</strong> tab to the right (Linux/Mac example below).</p>
<div class="codehilite"><pre><span></span>ssh student@&lt;rhgs1PublicIP&gt;
</pre></div>


<h2 id="about-disperse-volumes">About Disperse Volumes</h2>
<p>Gluster disperse volumes utilize <strong>erasure coding</strong> technology to provide data protection with a lower overall infrastructure investment. Unlike standard replication, in which to protect <em>n</em> bricks against <em>r</em> failures you must invest in a total of <em>n+(n*r)</em> bricks, with erasure coding you can design for the same level of protection with an investment of only <em>n+(n/r)</em> or even less, depending on the erasure coding ratio used.</p>
<p>For example, assume you need <em>n=4</em> bricks to hold your data set and you require protection from failure of <em>r=2</em> bricks. If you use standard <strong>replication</strong>, your investment in bricks will be <em>4+(4*2)</em> or <strong>12 total bricks</strong>. If instead you utilize <strong>erasure coding</strong>, your investment in bricks can be <em>4+(4/2)</em> or <strong>6 total bricks</strong>.</p>
<h3 id="erasure-coding-and-parity">Erasure Coding and Parity</h3>
<p>Instead of writing multiple exact copies of data, erasure coding algorithms write a combination of <em>data</em> and <em>parity</em> across bricks in the volume. A number of encoding algorithms are available offering varying levels of protection in terms of a <em>data-to-redundancy</em> ratio. For our lab, you will be using a 4:2 ratio &ndash; 2 levels of redundancy for every 4 data bricks, meaning that each disperse set requires exactly 6 bricks.</p>
<blockquote>
<p><strong>NOTE</strong> This functionality is very similar to how RAID works at the block level. You can relate our 4:2 erasure coding ratio to RAID level 6.</p>
</blockquote>
<p>When a file is written to the disperse volume, it is broken into calculated chunks of data plus parity and written across all of the bricks in the disperse set. When a file is read, it can be <strong>algorithmically reassembled from any n of the bricks where n is the number of data bricks in the set</strong>. Here with our 4:2 ratio, therefore, any 4 of the 6 bricks can be used to retrieve the files.</p>
<p><img alt="" src="../images/RHS_Gluster_Test_Drive-Module_1-dblack-201610-19.png" /></p>
<h3 id="use-cases">Use Cases</h3>
<p>Disperse volumes offer <em>space-efficient</em> and <em>capacity-optimized</em> storage architectures. However, there are a couple of primary tradeoffs when considering this method of data protection.</p>
<ul>
<li>The overhead of the algorithms can lead to decreased performance for your data set, particularly for reads and for small files.</li>
<li>The files are no longer stored in their whole original form on the brick backends, making offline or backend retrieval of data impossible.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong> Interestingly, it has been shown that, under most conditions with the Gluster native client, write performance is unaffected by erasure coding and is even sometimes modestly improved versus replication.</p>
</blockquote>
<p>Disperse volumes should be used when capacity is of greater value than performance. Larger file workloads (1GB+) will experience the least performance degredation versus replicated volumes. <em>You should avoid using the NFS client with disperse volumes.</em></p>
<h2 id="build-your-gdeploy-configuration">Build your gdeploy Configuration</h2>
<p>You will use the <strong>Ansible</strong>-based deployment tool <code>gdeploy</code> in order to create your disperse volume. For this, you will need to build a custom configuration file. Store this file as <code>/home/student/ecvol.conf</code>.</p>
<blockquote>
<p><strong>NOTE</strong> For your convenience, the <code>vim</code> and <code>emacs</code> editing tools are installed on all lab systems.</p>
</blockquote>
<h3 id="hosts-section">Hosts Section</h3>
<p>First you need to define in the <code>/home/student/ecvol.conf</code> config file the set of Gluster hosts that will participate in the disperse volume. You will use all 6 of your local lab server nodes.</p>
<div class="codehilite"><pre><span></span><span class="k">[hosts]</span>
<span class="na">rhgs1</span>
<span class="na">rhgs2</span>
<span class="na">rhgs3</span>
<span class="na">rhgs4</span>
<span class="na">rhgs5</span>
<span class="na">rhgs6</span>
</pre></div>


<h3 id="backend-setup-section">Backend-Setup Section</h3>
<p>The backend setup across all of the Gluster nodes is identical, and therefore we need only one universal backend-setup section in the config file. In this section, you define the block devices that will host the brick filesystems (<strong>the block device should be xvdd</strong>), the LVM structure (thin provisioning in this case), the filesystem mount point, and the subdirectory that will be used to host the brick.</p>
<div class="codehilite"><pre><span></span><span class="k">[backend-setup]</span>
<span class="na">devices</span><span class="o">=</span><span class="s">xvdd</span>
<span class="na">vgs</span><span class="o">=</span><span class="s">rhgs_vg3</span>
<span class="na">pools</span><span class="o">=</span><span class="s">rhgs_thinpool3</span>
<span class="na">lvs</span><span class="o">=</span><span class="s">rhgs_lv3</span>
<span class="na">mountpoints</span><span class="o">=</span><span class="s">/rhgs/brick_xvdd</span>
<span class="na">brick_dirs</span><span class="o">=</span><span class="s">/rhgs/brick_xvdd/ecvol</span>
</pre></div>


<h3 id="volume-section">Volume Section</h3>
<p>Next you define the specific architecture and configuration of the disperse volume you are creating. The <code>disperse_count</code> is the minimum number of data bricks for a file operation and the <code>redundancy_count</code> is the maximum number brick failures that can be sustained.</p>
<div class="codehilite"><pre><span></span><span class="k">[volume]</span>
<span class="na">action</span><span class="o">=</span><span class="s">create</span>
<span class="na">volname</span><span class="o">=</span><span class="s">ecvol</span>
<span class="na">disperse</span><span class="o">=</span><span class="s">yes</span>
<span class="na">disperse_count</span><span class="o">=</span><span class="s">4</span>
<span class="na">redundancy_count</span><span class="o">=</span><span class="s">2</span>
<span class="na">force</span><span class="o">=</span><span class="s">yes</span>
</pre></div>


<h3 id="clients-section">Clients Section</h3>
<p>Finally, you can automatically mount the new <strong>ecvol</strong> volume to the client systems. The <code>hosts</code> value is a comma-separated list of clients on which to make the mount.</p>
<div class="codehilite"><pre><span></span><span class="k">[clients]</span>
<span class="na">action</span><span class="o">=</span><span class="s">mount</span>
<span class="na">volname</span><span class="o">=</span><span class="s">ecvol</span>
<span class="na">hosts</span><span class="o">=</span><span class="s">client1,client2</span>
<span class="na">fstype</span><span class="o">=</span><span class="s">glusterfs</span>
<span class="na">client_mount_points</span><span class="o">=</span><span class="s">/rhgs/client/native/ecvol</span>
</pre></div>


<blockquote>
<p><strong>NOTE</strong> You can check your work against the provided <code>/home/student/materials/gdeploy/ecvol.conf</code> file.</p>
</blockquote>
<h2 id="deploy-and-review-your-disperse-volume">Deploy and Review your Disperse Volume</h2>
<p>Using <code>gdeploy</code> and the <code>/home/student/materials/gdeploy/ecvol.conf</code> file you&rsquo;ve created, automate the deployment of your disperse <strong>ecvol</strong> volume.</p>
<blockquote>
<p><strong>NOTE</strong> The <code>sudo</code> tool is not needed for the <code>gdeploy</code> command.</p>
</blockquote>
<div class="codehilite"><pre><span></span>gdeploy -c /home/student/materials/gdeploy/ecvol.conf
</pre></div>


<p>When the deployment completes, you should find that you have a properly-configured and started disperse Gluster volume.</p>
<div class="codehilite"><pre><span></span>sudo gluster volume info ecvol
</pre></div>


<div><code>
Volume Name: ecvol
Type: Disperse
Volume ID: 981dddb3-d99d-47bb-821e-b6fcb918a4f9
Status: Started
Number of Bricks: 1 x (4 + 2) = 6
Transport-type: tcp
Bricks:
Brick1: rhgs1:/rhgs/brick_xvdd/ecvol
Brick2: rhgs2:/rhgs/brick_xvdd/ecvol
Brick3: rhgs3:/rhgs/brick_xvdd/ecvol
Brick4: rhgs4:/rhgs/brick_xvdd/ecvol
Brick5: rhgs5:/rhgs/brick_xvdd/ecvol
Brick6: rhgs6:/rhgs/brick_xvdd/ecvol
Options Reconfigured:
performance.readdir-ahead: on
</code></div>

<p>Also take a look at the volume layout with the <code>gstatus</code> command.</p>
<div class="codehilite"><pre><span></span>sudo gstatus -l -w -v ecvol
</pre></div>


<div><code> 
     Product: RHGS Server v3.1Update3  Capacity:  60.00 GiB(raw bricks)
      Status: HEALTHY                      198.00 MiB(raw used)
   Glusterfs: 3.7.5                         40.00 GiB(usable from volumes)
  OverCommit: No                Snapshots:   0

Volume Information
    ecvol            UP - 6/6 bricks up - Disperse
                     Capacity: (0% used) 132.00 MiB/40.00 GiB (used/total)
                     Snapshots: 0
                     Self Heal:  6/ 6
                     Tasks Active: None
                     Protocols: glusterfs:on  NFS:on  SMB:on
                     Gluster Connectivty: 8 hosts, 84 tcp connections

    ecvol----------- +
                     |
                Disperse (ida)
                         |
                         +-- Disperse set0 (ida)
                               |
                               +--rhgs1:/rhgs/brick_xvdd/ecvol(UP) 33.00 MiB/10.00 GiB 
                               |
                               +--rhgs2:/rhgs/brick_xvdd/ecvol(UP) 33.00 MiB/10.00 GiB 
                               |
                               +--rhgs3:/rhgs/brick_xvdd/ecvol(UP) 33.00 MiB/10.00 GiB 
                               |
                               +--rhgs4:/rhgs/brick_xvdd/ecvol(UP) 33.00 MiB/10.00 GiB 
                               |
                               +--rhgs5:/rhgs/brick_xvdd/ecvol(UP) 33.00 MiB/10.00 GiB 
                               |
                               +--rhgs6:/rhgs/brick_xvdd/ecvol(UP) 33.00 MiB/10.00 GiB
</code></div>

<h2 id="file-operations-on-a-disperse-volume">File Operations on a Disperse Volume</h2>
<h3 id="create-files-from-the-client">Create Files from the Client</h3>
<p>From <strong>rhgs1</strong> connect via SSH to <strong>client1</strong>.</p>
<div class="codehilite"><pre><span></span>ssh student@client1
</pre></div>


<p>Confirm that your <strong>ecvol</strong> volume is mounted.</p>
<div class="codehilite"><pre><span></span>mount <span class="p">|</span> grep ecvol
</pre></div>


<p><code>rhgs1:ecvol on /rhgs/client/native/ecvol type fuse.glusterfs (rw,relatime,user_id=0,group_id=0,default_permissions,allow_other,max_read=131072)</code></p>
<div class="codehilite"><pre><span></span>df -h /rhgs/client/native/ecvol
</pre></div>


<p><code>Filesystem      Size  Used Avail Use% Mounted on</code><br />
<code>rhgs1:ecvol      40G  133M   40G   1% /rhgs/client/native/ecvol</code></p>
<p>Write a few 10MB files of <strong>plain text</strong> to the <strong>ecvol</strong> volume.</p>
<div class="codehilite"><pre><span></span>sudo mkdir /rhgs/client/native/ecvol/mydir
sudo chmod <span class="m">777</span> /rhgs/client/native/ecvol/mydir/
<span class="k">for</span> i in <span class="o">{</span><span class="m">0</span>..5<span class="o">}</span><span class="p">;</span> <span class="k">do</span> base64 /dev/urandom <span class="p">|</span> head -c 10240k &gt; /rhgs/client/native/ecvol/mydir/ecfile<span class="nv">$i</span><span class="p">;</span> <span class="k">done</span>
</pre></div>


<div class="codehilite"><pre><span></span>ls -lh /rhgs/client/native/ecvol/mydir/
</pre></div>


<div><code>
total 60M
-rw-rw-r--. 1 student student 10M Nov 10 14:11 ecfile0
-rw-rw-r--. 1 student student 10M Nov 10 14:11 ecfile1
-rw-rw-r--. 1 student student 10M Nov 10 14:11 ecfile2
-rw-rw-r--. 1 student student 10M Nov 10 14:11 ecfile3
-rw-rw-r--. 1 student student 10M Nov 10 14:11 ecfile4
-rw-rw-r--. 1 student student 10M Nov 10 14:11 ecfile5
</code></div>

<p>Validate that you have created <strong>ASCII text</strong> files.</p>
<div class="codehilite"><pre><span></span>file /rhgs/client/native/ecvol/mydir/ecfile0 
</pre></div>


<p><code>/rhgs/client/native/ecvol/mydir/ecfile0: ASCII text</code></p>
<p>Return to lab node <strong>rhgs1</strong>.</p>
<div class="codehilite"><pre><span></span><span class="nb">exit</span>
</pre></div>


<p>Now take a look at your files on the brick backend. You will find that all of the files exist, but are smaller in size than what you created from the client.</p>
<div class="codehilite"><pre><span></span>ls -lh /rhgs/brick_xvdd/ecvol/mydir/
</pre></div>


<div><code>
total 15M
-rw-rw-r--. 2 student student 2.5M Nov 10 14:16 ecfile0
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile1
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile2
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile3
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile4
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile5
</code></div>

<p>Each one of these files in a fragment of the file created at the client combined with the parity data required to calculate the reassembly of the file.</p>
<p>Note that the file types here are <code>data</code> instead of <code>ASCII text</code>.</p>
<div class="codehilite"><pre><span></span>file /rhgs/brick_xvdd/ecvol/mydir/ecfile0 
</pre></div>


<p><code>/rhgs/brick_xvdd/ecvol/mydir/ecfile0: data</code></p>
<h3 id="test-disperse-volume-resilliency">Test Disperse Volume Resilliency</h3>
<p>Choose any 2 of the gluster nodes other than rhgs1 (<em>rhgs2 through rhgs6</em>), and stop all gluster processes on those nodes. <em>In the example here, we have chosen nodes <strong>rhgs2</strong> and <strong>rhgs5</strong>.</em></p>
<div class="codehilite"><pre><span></span><span class="k">for</span> i in <span class="m">2</span> <span class="m">5</span><span class="p">;</span> <span class="k">do</span> ssh root@rhgs<span class="nv">$i</span> <span class="s2">&quot;systemctl stop glusterd.service; pkill glusterfs; pkill glusterfsd&quot;</span><span class="p">;</span> <span class="k">done</span>
</pre></div>


<p>Take a look at the volume now with the <code>gstatus</code> tool. You will notice it is marked as <code>UNHEALTHY</code> and <code>DEGRADED</code>.</p>
<div class="codehilite"><pre><span></span>sudo gstatus -w -v ecvol
</pre></div>


<div><code> 
     Product: RHGS Server v3.1Update3  Capacity:  40.00 GiB(raw bricks)
      Status: UNHEALTHY(4)                 192.00 MiB(raw used)
   Glusterfs: 3.7.5                         40.00 GiB(usable from volumes)
  OverCommit: No                Snapshots:   0

Volume Information
    ecvol            UP(DEGRADED) - 4/6 bricks up - Disperse
                     Capacity: (0% used) 192.00 MiB/40.00 GiB (used/total)
                     Snapshots: 0
                     Self Heal:  4/ 6
                     Tasks Active: None
                     Protocols: glusterfs:on  NFS:on  SMB:on
                     Gluster Connectivty: 6 hosts, 40 tcp connections
</code></div>

<p>Return again to <strong>client1</strong> via SSH.</p>
<div class="codehilite"><pre><span></span>ssh student@client1
</pre></div>


<p>Perform file operations on the <strong>ecvol</strong> volume mount point to confirm that your data is still fully accessible with the volume in a degraded state.</p>
<div class="codehilite"><pre><span></span>ls -lh /rhgs/client/native/ecvol/mydir/
</pre></div>


<div><code>
total 60M
-rw-rw-r--. 1 student student 10M Nov 10 14:16 ecfile0
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile1
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile2
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile3
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile4
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile5
</code></div>

<div class="codehilite"><pre><span></span>file /rhgs/client/native/ecvol/mydir/ecfile3 
</pre></div>


<p><code>/rhgs/client/native/ecvol/mydir/ecfile3: ASCII text</code></p>
<div class="codehilite"><pre><span></span>stat /rhgs/client/native/ecvol/mydir/ecfile5
</pre></div>


<div><code>
  File: ‘/rhgs/client/native/ecvol/mydir/ecfile5’
  Size: 10485760    Blocks: 20480      IO Block: 131072 regular file
Device: 24h/36d Inode: 9763979935191258614  Links: 1
Access: (0664/-rw-rw-r--)  Uid: ( 1001/ student)   Gid: ( 1001/ student)
Context: system_u:object_r:fusefs_t:s0
Access: 2016-11-10 14:17:05.379530355 -0500
Modify: 2016-11-10 14:17:06.790558942 -0500
Change: 2016-11-10 14:17:06.799559124 -0500
 Birth: -
</code></div>

<div class="codehilite"><pre><span></span>cat /rhgs/client/native/ecvol/mydir/ecfile2 &gt; /dev/null
</pre></div>


<p>Create a new plain text file in the <strong>ecvol</strong> volume mount point.</p>
<div class="codehilite"><pre><span></span>base64 /dev/urandom <span class="p">|</span> head -c 10240k &gt; /rhgs/client/native/ecvol/mydir/ecfile6
</pre></div>


<div class="codehilite"><pre><span></span>ls -lh /rhgs/client/native/ecvol/mydir/
</pre></div>


<div><code>
total 70M
-rw-rw-r--. 1 student student 10M Nov 10 14:16 ecfile0
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile1
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile2
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile3
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile4
-rw-rw-r--. 1 student student 10M Nov 10 14:17 ecfile5
-rw-rw-r--. 1 student student 10M Nov 10 14:29 ecfile6
</code></div>

<p>Return to lab node <strong>rhgs1</strong>.</p>
<div class="codehilite"><pre><span></span><span class="nb">exit</span>
</pre></div>


<p>Note that the new file you created is available on node <strong>rhgs1</strong> where the Gluster processes were not shut down.</p>
<div class="codehilite"><pre><span></span>ls -lh /rhgs/brick_xvdd/ecvol/mydir/
</pre></div>


<div><code>
total 18M
-rw-rw-r--. 2 student student 2.5M Nov 10 14:16 ecfile0
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile1
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile2
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile3
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile4
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile5
-rw-rw-r--. 2 student student 2.5M Nov 10 14:29 ecfile6
</code></div>

<p>Connect via SSH to one of the nodes on which you stopped the Gluster processes above. We use <strong>rhgs2</strong> in the example.</p>
<div class="codehilite"><pre><span></span>ssh rhgs2
</pre></div>


<p>Note that on this node the new file you created does not exist.</p>
<div class="codehilite"><pre><span></span>ls -lh /rhgs/brick_xvdd/ecvol/mydir/
</pre></div>


<div><code>
total 15M
-rw-rw-r--. 2 student student 2.5M Nov 10 14:16 ecfile0
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile1
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile2
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile3
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile4
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile5
</code></div>

<p>Re-start the Gluster services on the nodes where you stopped them above. These are nodes <strong>rhgs2</strong> and <strong>rhgs5</strong> in our example.</p>
<div class="codehilite"><pre><span></span><span class="k">for</span> i in <span class="m">2</span> <span class="m">5</span><span class="p">;</span> <span class="k">do</span> ssh root@rhgs<span class="nv">$i</span> <span class="s2">&quot;systemctl start glusterd.service&quot;</span><span class="p">;</span> <span class="k">done</span>
</pre></div>


<p>Confirm that the <strong>ecvol</strong> volume is no longer in a <code>DEGRADED</code> state.</p>
<div class="codehilite"><pre><span></span>sudo gstatus -w -v ecvol
</pre></div>


<div><code>
     Product: RHGS Server v3.1Update3  Capacity:  60.00 GiB(raw bricks)
      Status: HEALTHY                      298.00 MiB(raw used)
   Glusterfs: 3.7.5                         40.00 GiB(usable from volumes)
  OverCommit: No                Snapshots:   0

Volume Information
    ecvol            UP - 6/6 bricks up - Disperse
                     Capacity: (0% used) 199.00 MiB/40.00 GiB (used/total)
                     Snapshots: 0
                     Self Heal:  6/ 6
                     Tasks Active: None
                     Protocols: glusterfs:on  NFS:on  SMB:on
                     Gluster Connectivty: 8 hosts, 84 tcp connections
</code></div>

<p>Allow a minute or two for the <strong>self-heal daemon</strong> to catch up, and then note that the new file you created is now available on this brick backend.</p>
<div class="codehilite"><pre><span></span>ls -lh /rhgs/brick_xvdd/ecvol/mydir/
</pre></div>


<div><code>
total 18M
-rw-rw-r--. 2 student student 2.5M Nov 10 14:16 ecfile0
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile1
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile2
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile3
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile4
-rw-rw-r--. 2 student student 2.5M Nov 10 14:17 ecfile5
-rw-rw-r--. 2 student student 2.5M Nov 10 14:29 ecfile6
</code></div>

<p>Return to node <strong>rhgs1</strong>.</p>
<div class="codehilite"><pre><span></span><span class="nb">exit</span>
</pre></div>


<h1 id="end-of-module-4">End of Module 4</h1>
<p>This concludes <strong>Gluster Test Drive Module 4 - Disperse Volumes (Erasure Coding)</strong>. You may continue now with Module 5, or return at any time to access the modules in any order you wish.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../gluster-module-3/" title="Module 3 - Volume Operations and Administration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Module 3 - Volume Operations and Administration
              </span>
            </div>
          </a>
        
        
          <a href="../gluster-module-5/" title="Module 5 - Snapshot Operations and Administration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Module 5 - Snapshot Operations and Administration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright ©2018 Red Hat, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.abd7b172.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>